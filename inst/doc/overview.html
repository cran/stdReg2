<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2024-09-10" />

<title>Estimation of causal effects using stdReg2</title>

<script src="overview_files/header-attrs-2.27/header-attrs.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="/home/micsac/R/x86_64-pc-linux-gnu-library/4.4/rmarkdown/rmarkdown/templates/html_vignette/resources/vignette.css" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Estimation of causal effects using
stdReg2</h1>
<h4 class="date">2024-09-10</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(stdReg2)</span></code></pre></div>
<div id="introduction-and-context" class="section level2">
<h2>Introduction and context</h2>
<p>Suppose <span class="math inline">\(X\)</span> denotes an exposure of
interest that takes values 0 or 1. This could represent two different
medical treatments, environmental exposures, economic policies, or
genetic variants. We will most often use biomedical examples because we
are biostatisticians.</p>
<p>We consider the setting where it is of interest to quantify the
effect of intervening with <span class="math inline">\(X\)</span> on
outcome that we will denote <span class="math inline">\(Y\)</span>. The
outcome could represent some numeric value, it could be the presence or
absence of a condition, or it could be the time between two events, such
as time from cancer diagnosis to death. Let <span
class="math inline">\(Y(X = x)\)</span> denote the potential outcome if
all subjects in the population would hypothetically be exposed to <span
class="math inline">\(X = x\)</span>.</p>
<p>To quantify the effect of <span class="math inline">\(X\)</span>, we
must summarize the distribution of <span class="math inline">\(Y(X =
x)\)</span> with some statistic. If <span
class="math inline">\(Y\)</span> is dichotomous, it is natural to use
<span class="math inline">\(p\{Y(X = x) = 1\}\)</span>, called the risk.
If <span class="math inline">\(Y\)</span> is continuous, the mean is a
natural summary statistic <span class="math inline">\(E\{Y(X =
x)\}\)</span>. If <span class="math inline">\(Y\)</span> is a continuous
time-to-event, the probability of exceeding a particular value <span
class="math inline">\(t\)</span> is a reasonable statistic: <span
class="math inline">\(p\{Y(X = x) &gt; t\}\)</span>. In general, denote
the summary statistic of choice as <span class="math inline">\(T\{Y(X =
x)\}\)</span>. The summary statistic can also be applied to conditional
distributions, which we will denote, e.g., <span
class="math inline">\(T\{Y | X = x\}\)</span>.</p>
<p>To quantify the effect of <span class="math inline">\(X\)</span>, we
must also decide on a <em>contrast</em> to measure the causal effect.
The point of the contrast is to compare the chosen summary statistic
between the <span class="math inline">\(X = 1\)</span> and <span
class="math inline">\(X = 0\)</span> interventions. Typical choices
would be the difference <span class="math inline">\(T\{Y(X = 1)\} -
T\{Y(X = 0)\}\)</span> or the ratio <span class="math inline">\(T\{Y(X =
1)\} / T\{Y(X = 0)\}\)</span>. It may also be of interest to quantify
and report the summary statistics within each group <span
class="math inline">\((T\{Y(X = 1)\}, T\{Y(X = 0)\})\)</span>.</p>
<p>In observational studies, the relationship between <span
class="math inline">\(X\)</span> and <span
class="math inline">\(Y\)</span> is likely confounded by a set of other
variables <span class="math inline">\(\boldsymbol{Z}\)</span>. This
means that the values of the outcome <span
class="math inline">\(Y\)</span> are determined by at least a subset of
<span class="math inline">\(\boldsymbol{Z}\)</span> and the values of
the exposure <span class="math inline">\(X\)</span> are determined by a
subset of <span class="math inline">\(\boldsymbol{Z}\)</span>. Naively
estimating the contrast would lead to biased estimates of the causal
effect.</p>
</div>
<div id="regression-standardization" class="section level2">
<h2>Regression standardization</h2>
<p>See <span class="citation">Sjölander (2016)</span> and <span
class="citation">Sjölander (2018)</span> for more details. Suppose that
the covariates <span class="math inline">\(\boldsymbol{Z}\)</span> are
sufficient for confounding control. For more information on what
constitutes a sufficient adjustment set, see <span
class="citation">Witte and Didelez (2019)</span>. For a given summary
statistic <span class="math inline">\(T\)</span>, then <span
class="math display">\[
T\{Y(X = x)\} = E_{\boldsymbol{Z}}[T\{Y | X = x, \boldsymbol{Z}\}],
\]</span> where the expectation is taken with respect to the population
distribution of <span class="math inline">\(\boldsymbol{Z}\)</span>.
This is also known as the <em>g-formula</em> or <em>adjustment
formula</em>.</p>
<p>In order to estimate this quantity based on an independent and
identically distributed sample <span class="math inline">\((X_1, Y_1,
\boldsymbol{Z}_1), \ldots, (X_n, Y_n, \boldsymbol{Z}_n)\)</span>, we
proceed by</p>
<ol style="list-style-type: decimal">
<li>Specifying and estimating a regression model for <span
class="math inline">\(Y\)</span> given <span
class="math inline">\(X\)</span> and <span
class="math inline">\(\boldsymbol{Z}\)</span>.</li>
<li>Use the fitted model to obtain estimates of <span
class="math inline">\(T\{Y_i | X_i = x, \boldsymbol{Z}_i\}\)</span> for
<span class="math inline">\(i = 1, \ldots, n\)</span>. This is done by
creating a copy of the observed dataset, replacing the observed <span
class="math inline">\(X_i\)</span> with <span
class="math inline">\(x\)</span> for each individual, and using the
fitted model to get predicted values for the copy of the observed data.
Denote these predicted values as <span
class="math inline">\(\hat{T}\{Y_i | X_i = x,
\boldsymbol{Z}_i\}\)</span>.</li>
<li>Average over the empirical distribution of <span
class="math inline">\(\boldsymbol{Z}\)</span> to obtain the estimate
<span class="math display">\[
\hat{T}\{Y(X = x)\} = \frac{1}{n}\sum_{i = 1}^n \hat{T}\{Y_i | X_i = x,
\boldsymbol{Z}_i\}.
\]</span></li>
</ol>
<p>One can do this for each level of <span class="math inline">\(X = 0,
1\)</span> and compute the desired contrast. Under the assumptions that
1) <span class="math inline">\(\boldsymbol{Z}\)</span> is sufficient for
confounding control, and 2) the regression model in step 1 is correctly
specified, then this estimator is consistent and asymptotically
normal.</p>
</div>
<div id="improving-robustness-by-modeling-the-exposure"
class="section level2">
<h2>Improving robustness by modeling the exposure</h2>
<p>A doubly-robust estimator is an estimator that is consistent for a
given estimand when one or more of the models used in the forming of the
estimator is correctly specified for confounding. So far, we only have
one model used in our estimator: the <em>outcome model</em>. We will now
introduce a model for the exposure, and see how we can combine them.
First, some terminology:</p>
<p><em>Misspecified model</em> - The true generating mechanism is not
contained in the possible mechanisms that are possible under the
selected model.</p>
<p><em>Correctly Specified</em> - A model is correctly specified if it
is not misspecified.</p>
<p><em>Correctly specified for confounding</em> - A correctly specified
model that contains a sufficient set of confounders.</p>
<p>If we can model <span
class="math inline">\(P(X=1|\boldsymbol{Z})\)</span>, and it is
correctly specified and contains all confounders, then we can use that
to estimate the probability that each individual <span
class="math inline">\(i\)</span> received the treatment that they did
<span class="math inline">\(W_i = \frac{X_i}{P(X_i=1|\boldsymbol{Z}_i)}
+ \frac{1-X_i}{1-P(X_i=1|\boldsymbol{Z}_i)}\)</span>. Let <span
class="math inline">\(\hat{p}_i\)</span> denote the estimated
probability that subject <span class="math inline">\(i\)</span> received
treatment <span class="math inline">\(1\)</span>.</p>
<p>Any consistent estimation method can be used for the outcome and
exposure models. As long as <em>either</em> the outcome model
<em>or</em> the propensity score model is correctly specified for
confounding, then a doubly robust estimator is consistent for the ATE.
In this package, for generalized linear models, we use the estimator as
described by <span class="citation">Gabriel et al. (2024)</span>.</p>
<p>Recently, there seems to be a general misconception that combining an
adjusted outcome model and a propensity score model always gives a
doubly robust estimator. <strong>This is not true</strong> – it matters
how you combine them!</p>
</div>
<div id="in-practice" class="section level1">
<h1>In practice</h1>
<p>Here we will use regression standardization to estimate the average
causal effect of the exposure (quitting smoking) in the variable
<code>qsmk</code> on the weight gain outcome in the variable
<code>wt82_71</code> in the <code>nhefs_complete</code> dataset that
comes with the <code>causaldata</code> package. The data was collected
as part of a project by the National Center for Health Statistics and
the National Institute on Aging in collaboration with other agencies of
the United States Public Health Service. It was designed to investigate
the relationships between clinical, nutritional, and behavioral factors
and subsequent morbidity, mortality, and hospital utilization and
changes in risk factors, functional limitation, and
institutionalization. The dataset includes 1566 individuals and contains
among others the following variables:</p>
<ul>
<li>seqn: person id}</li>
<li>wt82_71: weight gain in kilograms between 1971 and 1982</li>
<li>qsmk: quit smoking between between 1st questionnaire and 1982, 1 =
yes, 0 = no</li>
<li>sex: 0 = male, 1 = female</li>
<li>race: 0 = white, 1 = black or other</li>
<li>age: age in years at baseline</li>
<li>education: level of education in 1971, 1 = 8th grade or less, 2 =
high school dropout, 3 = high school, 4 - dropout, 5 = college or
more</li>
<li>smokeintensity: number of cigarettes smoked per day in 1971</li>
<li>smokeyrs: number of years smoked</li>
<li>exercise: level of physical activity in 1971, 0 = much exercise, 1 =
moderate exercise, 2 = little or no exercise</li>
<li>active: level of activity in 1971, 0 = very active, 1 = moderately
active, 2 = inactive, 3 = missing</li>
<li>wt71: weight in kilograms in 1971</li>
<li>ht: height in centimeters in 1971</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>nhefs_dat <span class="ot">&lt;-</span> causaldata<span class="sc">::</span>nhefs_complete</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">summary</span>(nhefs_dat)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="co">#&gt;       seqn            qsmk            death            yrdth      </span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;  Min.   :  233   Min.   :0.0000   Min.   :0.0000   Min.   :83.00  </span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:10625   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:85.00  </span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt;  Median :20702   Median :0.0000   Median :0.0000   Median :88.00  </span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt;  Mean   :16639   Mean   :0.2573   Mean   :0.1858   Mean   :87.64  </span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:22771   3rd Qu.:1.0000   3rd Qu.:0.0000   3rd Qu.:90.00  </span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt;  Max.   :25061   Max.   :1.0000   Max.   :1.0000   Max.   :92.00  </span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="co">#&gt;                                                    NA&#39;s   :1275   </span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;      modth            dadth           sbp             dbp         sex    </span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt;  Min.   : 1.000   Min.   : 1.0   Min.   : 87.0   Min.   : 47.00   0:762  </span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co">#&gt;  1st Qu.: 3.000   1st Qu.: 8.0   1st Qu.:115.0   1st Qu.: 70.00   1:804  </span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a><span class="co">#&gt;  Median : 6.000   Median :16.0   Median :126.0   Median : 77.00          </span></span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="co">#&gt;  Mean   : 6.383   Mean   :16.1   Mean   :128.6   Mean   : 77.74          </span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:10.000   3rd Qu.:24.5   3rd Qu.:139.0   3rd Qu.: 85.00          </span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="co">#&gt;  Max.   :12.000   Max.   :31.0   Max.   :229.0   Max.   :130.00          </span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co">#&gt;  NA&#39;s   :1271     NA&#39;s   :1271   NA&#39;s   :29      NA&#39;s   :33              </span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a><span class="co">#&gt;       age        race         income         marital          school     </span></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co">#&gt;  Min.   :25.00   0:1360   Min.   :11.00   Min.   :2.000   Min.   : 0.00  </span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:33.00   1: 206   1st Qu.:17.00   1st Qu.:2.000   1st Qu.:10.00  </span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a><span class="co">#&gt;  Median :43.00            Median :19.00   Median :2.000   Median :12.00  </span></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="co">#&gt;  Mean   :43.66            Mean   :17.99   Mean   :2.496   Mean   :11.17  </span></span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:53.00            3rd Qu.:20.00   3rd Qu.:2.000   3rd Qu.:12.00  </span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co">#&gt;  Max.   :74.00            Max.   :22.00   Max.   :8.000   Max.   :17.00  </span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a><span class="co">#&gt;                           NA&#39;s   :59                                     </span></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co">#&gt;  education       ht             wt71             wt82           wt82_71       </span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a><span class="co">#&gt;  1:291     Min.   :142.9   Min.   : 39.58   Min.   : 35.38   Min.   :-41.280  </span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a><span class="co">#&gt;  2:340     1st Qu.:161.8   1st Qu.: 59.53   1st Qu.: 61.69   1st Qu.: -1.478  </span></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a><span class="co">#&gt;  3:637     Median :168.2   Median : 69.23   Median : 72.12   Median :  2.604  </span></span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a><span class="co">#&gt;  4:121     Mean   :168.7   Mean   : 70.83   Mean   : 73.47   Mean   :  2.638  </span></span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a><span class="co">#&gt;  5:177     3rd Qu.:175.3   3rd Qu.: 79.80   3rd Qu.: 83.46   3rd Qu.:  6.690  </span></span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a><span class="co">#&gt;            Max.   :198.1   Max.   :151.73   Max.   :136.53   Max.   : 48.538  </span></span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a><span class="co">#&gt;                                                                               </span></span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a><span class="co">#&gt;    birthplace    smokeintensity  smkintensity82_71    smokeyrs    </span></span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a><span class="co">#&gt;  Min.   : 1.00   Min.   : 1.00   Min.   :-80.000   Min.   : 1.00  </span></span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:22.00   1st Qu.:10.00   1st Qu.:-10.000   1st Qu.:15.00  </span></span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a><span class="co">#&gt;  Median :34.00   Median :20.00   Median : -1.000   Median :24.00  </span></span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a><span class="co">#&gt;  Mean   :31.67   Mean   :20.53   Mean   : -4.633   Mean   :24.59  </span></span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:42.00   3rd Qu.:30.00   3rd Qu.:  1.000   3rd Qu.:33.00  </span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a><span class="co">#&gt;  Max.   :56.00   Max.   :80.00   Max.   : 50.000   Max.   :64.00  </span></span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a><span class="co">#&gt;  NA&#39;s   :90                                                       </span></span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a><span class="co">#&gt;      asthma            bronch              tb                hf          </span></span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000000  </span></span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000000  </span></span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :0.00000   Median :0.000000  </span></span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.04853   Mean   :0.08365   Mean   :0.01341   Mean   :0.005109  </span></span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000000  </span></span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000000  </span></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="co">#&gt;                                                                          </span></span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a><span class="co">#&gt;       hbp         pepticulcer        colitis          hepatitis      </span></span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.000   Min.   :0.0000   Min.   :0.00000   Min.   :0.00000  </span></span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.000   1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000  </span></span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a><span class="co">#&gt;  Median :1.000   Median :0.0000   Median :0.00000   Median :0.00000  </span></span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a><span class="co">#&gt;  Mean   :1.059   Mean   :0.1015   Mean   :0.03448   Mean   :0.01788  </span></span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:2.000   3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.00000  </span></span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a><span class="co">#&gt;  Max.   :2.000   Max.   :1.0000   Max.   :1.00000   Max.   :1.00000  </span></span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a><span class="co">#&gt;                                                                      </span></span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a><span class="co">#&gt;   chroniccough        hayfever          diabetes          polio        </span></span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.0000   Min.   :0.00000  </span></span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.00000  </span></span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :0.0000   Median :0.00000  </span></span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.05109   Mean   :0.08621   Mean   :0.9898   Mean   :0.01405  </span></span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:2.0000   3rd Qu.:0.00000  </span></span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :2.0000   Max.   :1.00000  </span></span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a><span class="co">#&gt;                                                                        </span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a><span class="co">#&gt;      tumor          nervousbreak       alcoholpy       alcoholfreq   </span></span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.00000   Min.   :0.00000   Min.   :0.0000   Min.   :0.000  </span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:1.0000   1st Qu.:1.000  </span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a><span class="co">#&gt;  Median :0.00000   Median :0.00000   Median :1.0000   Median :2.000  </span></span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.02363   Mean   :0.02746   Mean   :0.8787   Mean   :1.913  </span></span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:1.0000   3rd Qu.:3.000  </span></span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.00000   Max.   :1.00000   Max.   :2.0000   Max.   :5.000  </span></span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a><span class="co">#&gt;                                                                      </span></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a><span class="co">#&gt;   alcoholtype    alcoholhowmuch        pica          headache     </span></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="co">#&gt;  Min.   :1.000   Min.   : 1.000   Min.   :0.000   Min.   :0.0000  </span></span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:1.000   1st Qu.: 2.000   1st Qu.:0.000   1st Qu.:0.0000  </span></span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a><span class="co">#&gt;  Median :3.000   Median : 2.000   Median :0.000   Median :1.0000  </span></span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a><span class="co">#&gt;  Mean   :2.466   Mean   : 3.293   Mean   :0.986   Mean   :0.6328  </span></span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:4.000   3rd Qu.: 4.000   3rd Qu.:2.000   3rd Qu.:1.0000  </span></span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a><span class="co">#&gt;  Max.   :4.000   Max.   :48.000   Max.   :2.000   Max.   :1.0000  </span></span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a><span class="co">#&gt;                  NA&#39;s   :397                                      </span></span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a><span class="co">#&gt;    otherpain        weakheart         allergies           nerves     </span></span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.0000   Min.   :0.00000   Min.   :0.00000   Min.   :0.000  </span></span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.0000   1st Qu.:0.00000   1st Qu.:0.00000   1st Qu.:0.000  </span></span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a><span class="co">#&gt;  Median :0.0000   Median :0.00000   Median :0.00000   Median :0.000  </span></span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.2433   Mean   :0.02235   Mean   :0.06322   Mean   :0.145  </span></span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.0000   3rd Qu.:0.00000   3rd Qu.:0.00000   3rd Qu.:0.000  </span></span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.0000   Max.   :1.00000   Max.   :1.00000   Max.   :1.000  </span></span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a><span class="co">#&gt;                                                                      </span></span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a><span class="co">#&gt;     lackpep            hbpmed       boweltrouble       wtloss       </span></span>
<span id="cb2-92"><a href="#cb2-92" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.00000   Min.   :0.000   Min.   :0.000   Min.   :0.00000  </span></span>
<span id="cb2-93"><a href="#cb2-93" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.00000   1st Qu.:0.000   1st Qu.:0.000   1st Qu.:0.00000  </span></span>
<span id="cb2-94"><a href="#cb2-94" tabindex="-1"></a><span class="co">#&gt;  Median :0.00000   Median :1.000   Median :1.000   Median :0.00000  </span></span>
<span id="cb2-95"><a href="#cb2-95" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.05045   Mean   :1.015   Mean   :1.046   Mean   :0.02618  </span></span>
<span id="cb2-96"><a href="#cb2-96" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.00000   3rd Qu.:2.000   3rd Qu.:2.000   3rd Qu.:0.00000  </span></span>
<span id="cb2-97"><a href="#cb2-97" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.00000   Max.   :2.000   Max.   :2.000   Max.   :1.00000  </span></span>
<span id="cb2-98"><a href="#cb2-98" tabindex="-1"></a><span class="co">#&gt;                                                                     </span></span>
<span id="cb2-99"><a href="#cb2-99" tabindex="-1"></a><span class="co">#&gt;    infection     active  exercise  birthcontrol    pregnancies    </span></span>
<span id="cb2-100"><a href="#cb2-100" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.000   0:702   0:300    Min.   :0.000   Min.   : 1.000  </span></span>
<span id="cb2-101"><a href="#cb2-101" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.000   1:715   1:661    1st Qu.:0.000   1st Qu.: 2.000  </span></span>
<span id="cb2-102"><a href="#cb2-102" tabindex="-1"></a><span class="co">#&gt;  Median :0.000   2:149   2:605    Median :1.000   Median : 3.000  </span></span>
<span id="cb2-103"><a href="#cb2-103" tabindex="-1"></a><span class="co">#&gt;  Mean   :0.145                    Mean   :1.081   Mean   : 3.694  </span></span>
<span id="cb2-104"><a href="#cb2-104" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:0.000                    3rd Qu.:2.000   3rd Qu.: 5.000  </span></span>
<span id="cb2-105"><a href="#cb2-105" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.000                    Max.   :2.000   Max.   :15.000  </span></span>
<span id="cb2-106"><a href="#cb2-106" tabindex="-1"></a><span class="co">#&gt;                                                   NA&#39;s   :866     </span></span>
<span id="cb2-107"><a href="#cb2-107" tabindex="-1"></a><span class="co">#&gt;   cholesterol      hightax82         price71         price82     </span></span>
<span id="cb2-108"><a href="#cb2-108" tabindex="-1"></a><span class="co">#&gt;  Min.   : 78.0   Min.   :0.0000   Min.   :1.507   Min.   :1.452  </span></span>
<span id="cb2-109"><a href="#cb2-109" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:189.0   1st Qu.:0.0000   1st Qu.:2.037   1st Qu.:1.740  </span></span>
<span id="cb2-110"><a href="#cb2-110" tabindex="-1"></a><span class="co">#&gt;  Median :216.0   Median :0.0000   Median :2.168   Median :1.815  </span></span>
<span id="cb2-111"><a href="#cb2-111" tabindex="-1"></a><span class="co">#&gt;  Mean   :219.9   Mean   :0.1653   Mean   :2.138   Mean   :1.806  </span></span>
<span id="cb2-112"><a href="#cb2-112" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:245.0   3rd Qu.:0.0000   3rd Qu.:2.242   3rd Qu.:1.868  </span></span>
<span id="cb2-113"><a href="#cb2-113" tabindex="-1"></a><span class="co">#&gt;  Max.   :416.0   Max.   :1.0000   Max.   :2.693   Max.   :2.103  </span></span>
<span id="cb2-114"><a href="#cb2-114" tabindex="-1"></a><span class="co">#&gt;  NA&#39;s   :16      NA&#39;s   :90       NA&#39;s   :90      NA&#39;s   :90     </span></span>
<span id="cb2-115"><a href="#cb2-115" tabindex="-1"></a><span class="co">#&gt;      tax71            tax82          price71_82         tax71_82     </span></span>
<span id="cb2-116"><a href="#cb2-116" tabindex="-1"></a><span class="co">#&gt;  Min.   :0.5249   Min.   :0.2200   Min.   :-0.2027   Min.   :0.0360  </span></span>
<span id="cb2-117"><a href="#cb2-117" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:0.9449   1st Qu.:0.4399   1st Qu.: 0.2010   1st Qu.:0.4610  </span></span>
<span id="cb2-118"><a href="#cb2-118" tabindex="-1"></a><span class="co">#&gt;  Median :1.0498   Median :0.5060   Median : 0.3360   Median :0.5440  </span></span>
<span id="cb2-119"><a href="#cb2-119" tabindex="-1"></a><span class="co">#&gt;  Mean   :1.0580   Mean   :0.5058   Mean   : 0.3324   Mean   :0.5522  </span></span>
<span id="cb2-120"><a href="#cb2-120" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:1.1548   3rd Qu.:0.5719   3rd Qu.: 0.4438   3rd Qu.:0.6220  </span></span>
<span id="cb2-121"><a href="#cb2-121" tabindex="-1"></a><span class="co">#&gt;  Max.   :1.5225   Max.   :0.7479   Max.   : 0.6121   Max.   :0.8844  </span></span>
<span id="cb2-122"><a href="#cb2-122" tabindex="-1"></a><span class="co">#&gt;  NA&#39;s   :90       NA&#39;s   :90       NA&#39;s   :90        NA&#39;s   :90      </span></span>
<span id="cb2-123"><a href="#cb2-123" tabindex="-1"></a><span class="co">#&gt;        id            censored     older       </span></span>
<span id="cb2-124"><a href="#cb2-124" tabindex="-1"></a><span class="co">#&gt;  Min.   :   1.0   Min.   :0   Min.   :0.0000  </span></span>
<span id="cb2-125"><a href="#cb2-125" tabindex="-1"></a><span class="co">#&gt;  1st Qu.: 414.2   1st Qu.:0   1st Qu.:0.0000  </span></span>
<span id="cb2-126"><a href="#cb2-126" tabindex="-1"></a><span class="co">#&gt;  Median : 824.5   Median :0   Median :0.0000  </span></span>
<span id="cb2-127"><a href="#cb2-127" tabindex="-1"></a><span class="co">#&gt;  Mean   : 821.0   Mean   :0   Mean   :0.2989  </span></span>
<span id="cb2-128"><a href="#cb2-128" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:1228.8   3rd Qu.:0   3rd Qu.:1.0000  </span></span>
<span id="cb2-129"><a href="#cb2-129" tabindex="-1"></a><span class="co">#&gt;  Max.   :1629.0   Max.   :0   Max.   :1.0000  </span></span>
<span id="cb2-130"><a href="#cb2-130" tabindex="-1"></a><span class="co">#&gt; </span></span></code></pre></div>
<p>We will assume that the set of confounders in <span
class="math inline">\(\boldsymbol{Z}\)</span> includes sex, race, age,
education, number of cigarettes smoked per year, the number of years
smoked, level of physical activity, and baseline weight in 1971. This
equivalent to assuming that the counterfactual weight gain is
independent of the exposure conditional on these variables. In other
words, we are assuming the following directed acyclic graph:</p>
<p><img src="overview_files/figure-html/unnamed-chunk-3-1.png" width="30%" /></p>
<p>For the specific forms of the conditional expectations required in
the outcome we assume a linear regression model with both linear and
quadratic forms of the continuous covariates. We can fit this as</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>m <span class="ot">&lt;-</span> <span class="fu">glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>        <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>        smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>          wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="at">data =</span> nhefs_dat)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">summary</span>(m)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a><span class="co">#&gt; glm(formula = wt82_71 ~ qsmk + sex + race + age + I(age^2) + </span></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a><span class="co">#&gt;     as.factor(education) + smokeintensity + I(smokeintensity^2) + </span></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a><span class="co">#&gt;     smokeyrs + I(smokeyrs^2) + as.factor(exercise) + as.factor(active) + </span></span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a><span class="co">#&gt;     wt71 + I(wt71^2), data = nhefs_dat)</span></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="co">#&gt;                         Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a><span class="co">#&gt; (Intercept)           -1.6586176  4.3137734  -0.384 0.700666    </span></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a><span class="co">#&gt; qsmk                   3.4626218  0.4384543   7.897 5.36e-15 ***</span></span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a><span class="co">#&gt; sex1                  -1.4650496  0.4683410  -3.128 0.001792 ** </span></span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a><span class="co">#&gt; race1                  0.5864117  0.5816949   1.008 0.313560    </span></span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a><span class="co">#&gt; age                    0.3626624  0.1633431   2.220 0.026546 *  </span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a><span class="co">#&gt; I(age^2)              -0.0061377  0.0017263  -3.555 0.000389 ***</span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2  0.8185263  0.6067815   1.349 0.177546    </span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3  0.5715004  0.5561211   1.028 0.304273    </span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a><span class="co">#&gt; as.factor(education)4  1.5085173  0.8323778   1.812 0.070134 .  </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5 -0.1708264  0.7413289  -0.230 0.817786    </span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a><span class="co">#&gt; smokeintensity         0.0651533  0.0503115   1.295 0.195514    </span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a><span class="co">#&gt; I(smokeintensity^2)   -0.0010468  0.0009373  -1.117 0.264261    </span></span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a><span class="co">#&gt; smokeyrs               0.1333931  0.0917319   1.454 0.146104    </span></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a><span class="co">#&gt; I(smokeyrs^2)         -0.0018270  0.0015438  -1.183 0.236818    </span></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)1   0.3206824  0.5349616   0.599 0.548961    </span></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a><span class="co">#&gt; as.factor(exercise)2   0.3628786  0.5589557   0.649 0.516300    </span></span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a><span class="co">#&gt; as.factor(active)1    -0.9429574  0.4100208  -2.300 0.021593 *  </span></span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a><span class="co">#&gt; as.factor(active)2    -0.2580374  0.6847219  -0.377 0.706337    </span></span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a><span class="co">#&gt; wt71                   0.0373642  0.0831658   0.449 0.653297    </span></span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a><span class="co">#&gt; I(wt71^2)             -0.0009158  0.0005235  -1.749 0.080426 .  </span></span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a><span class="co">#&gt; ---</span></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 53.59474)</span></span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a><span class="co">#&gt;     Null deviance: 97176  on 1565  degrees of freedom</span></span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a><span class="co">#&gt; Residual deviance: 82857  on 1546  degrees of freedom</span></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a><span class="co">#&gt; AIC: 10701</span></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre></div>
<p>To perform regression standardization to estimate the causal effect
we use <code>standardize_glm</code>. We must specify the same outcome
regression model as a formula, provide the data, describe which values
of the exposure we wish to estimate the counterfactual means, specify
which contrasts we want, and specify the reference level for the
contrasts. The following command estimates that model and we obtain the
group-wise estimates, the difference, and the ratio.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">standardize_glm</span>(wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>            <span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">&quot;difference&quot;</span>, <span class="st">&quot;ratio&quot;</span>),</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a>m2</span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; Outcome formula: wt82_71 ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="co">#&gt; Outcome family: gaussian </span></span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a><span class="co">#&gt; Outcome link function: identity </span></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="co">#&gt; 1    0     1.75     0.217       1.32       2.17</span></span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a><span class="co">#&gt; 2    1     5.21     0.420       4.39       6.03</span></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a><span class="co">#&gt; 1    0     0.00     0.000       0.00       0.00</span></span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a><span class="co">#&gt; 2    1     3.46     0.466       2.55       4.38</span></span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a><span class="co">#&gt; Contrast:  ratio </span></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="co">#&gt; 1    0     1.00     0.000       1.00       1.00</span></span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a><span class="co">#&gt; 2    1     2.98     0.435       2.13       3.83</span></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a><span class="fu">plot</span>(m2)</span></code></pre></div>
<p><img
src="overview_files/figure-html/unnamed-chunk-5-1.png" /><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">plot</span>(m2, <span class="at">contrast =</span> <span class="st">&quot;difference&quot;</span>, <span class="at">reference =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img
src="overview_files/figure-html/unnamed-chunk-5-2.png" /><!-- --></p>
<p>The output from the model shows the estimated potential outcome means
in each exposure level, the difference and ratio thereof, and the
associated standard error estimates, confidence intervals, and p-values.
Inference is done using the sandwich method for variance calculation.
Under the assumptions that the outcome model is correctly specified and
contains all confounders, these are consistent estimates of the causal
effects of interest. We can also get plots of the effects by using the
plot function.</p>
<p>To obtain the estimates and inference for the different contrasts as
a tidy data frame, suitable for saving as a data table or using in
downstream analyses or reports, we provide the <code>tidy</code>
function:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>(<span class="fu">tidy</span>(m2) <span class="ot">-&gt;</span> tidy_m2) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95   contrast transform</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; 1    0 1.747216 0.2174047   1.321111   2.173322       none  identity</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; 2    1 5.209838 0.4199393   4.386772   6.032904       none  identity</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; 3    0 0.000000 0.0000000   0.000000   0.000000 difference  identity</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 4    1 3.462622 0.4660848   2.549112   4.376131 difference  identity</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 5    0 1.000000 0.0000000   1.000000   1.000000      ratio  identity</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 6    1 2.981793 0.4349643   2.129279   3.834308      ratio  identity</span></span></code></pre></div>
<p>To obtain doubly robust inference we use the following command. Note
that we now specify a model for the exposure, the propensity score
model.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>m2_dr <span class="ot">&lt;-</span> <span class="fu">standardize_glm_dr</span>(<span class="at">formula_outcome =</span> wt82_71 <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>               <span class="at">formula_exposure =</span> qsmk <span class="sc">~</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>                <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>                smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span> </span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>                wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>            <span class="at">contrast =</span> <span class="fu">c</span>(<span class="st">&quot;difference&quot;</span>, <span class="st">&quot;ratio&quot;</span>),</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>) </span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>m2_dr</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a><span class="co">#&gt; Doubly robust estimator with: </span></span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a><span class="co">#&gt; Exposure formula: qsmk ~ sex + race + age + I(age^2) + as.factor(education) + smokeintensity + </span></span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a><span class="co">#&gt;     I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + as.factor(exercise) + </span></span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a><span class="co">#&gt;     as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a><span class="co">#&gt; Exposure link function: logit </span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a><span class="co">#&gt; Outcome formula: wt82_71 ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a><span class="co">#&gt; Outcome family: gaussian </span></span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a><span class="co">#&gt; Outcome link function: identity </span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a><span class="co">#&gt; 1    0     1.76     0.218       1.34       2.19</span></span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a><span class="co">#&gt; 2    1     5.19     0.438       4.33       6.04</span></span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="co">#&gt; 1    0     0.00      0.00       0.00       0.00</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a><span class="co">#&gt; 2    1     3.42      0.48       2.48       4.37</span></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a><span class="co">#&gt; Contrast:  ratio </span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="co">#&gt; 1    0     1.00     0.000        1.0       1.00</span></span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a><span class="co">#&gt; 2    1     2.94     0.431        2.1       3.79</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>(<span class="fu">tidy</span>(m2_dr) <span class="ot">-&gt;</span> tidy_m2_dr) <span class="sc">|&gt;</span> <span class="fu">print</span>()</span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95   contrast transform</span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="co">#&gt; 1    0 1.762981 0.2176810   1.336334   2.189628       none  identity</span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a><span class="co">#&gt; 2    1 5.186772 0.4378466   4.328609   6.044936       none  identity</span></span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a><span class="co">#&gt; 3    0 0.000000 0.0000000   0.000000   0.000000 difference  identity</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a><span class="co">#&gt; 4    1 3.423792 0.4804026   2.482220   4.365363 difference  identity</span></span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a><span class="co">#&gt; 5    0 1.000000 0.0000000   1.000000   1.000000      ratio  identity</span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a><span class="co">#&gt; 6    1 2.942047 0.4310190   2.097265   3.786829      ratio  identity</span></span></code></pre></div>
<p>Based on these results, we can report that the estimated effect of
smoking on average weight change as measured by the difference in
potential outcome means is 3.46 (2.55 to 4.38) and as measured by the
ratio of potential outcome means is 2.98 (2.13 to 3.83). Using the
doubly-robust estimation method, we obtain similarly 3.42 (2.48 to 4.37)
and as measured by the ratio of potential outcome means is 2.94 (2.10 to
3.79). In particular, if we believe that the necessary assumptions are
valid, we can conclude that smoking causes an increase in weight which
the numeric summaries indicate that smoking increases the weight change
over 11 years by about 3.5 pounds (additive scale) or smoking increases
the weight change over 11 years by a multiplicative factor of about
3.</p>
<p>The doubly-robust method requires specification of an exposure model
in addition to the specification of the outcome model. Both of these
estimated models can be accessed and inspected by looking at the
<code>fit_outcome</code> and <code>fit_exposure</code> elements of the
return object:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>m2_dr<span class="sc">$</span>res<span class="sc">$</span>fit_outcome</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; Call:  fit_glm(formula = formula_outcome, family = family_outcome, data = data, </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt;     response = &quot;outcome&quot;, weights = weights)</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt;           (Intercept)                   qsmk                   sex1  </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt;            -1.931e+00              3.424e+00             -1.989e+00  </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;                 race1                    age               I(age^2)  </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;             4.707e-01              6.207e-01             -8.678e-03  </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt; as.factor(education)2  as.factor(education)3  as.factor(education)4  </span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;             1.935e+00              8.366e-01              2.564e+00  </span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt; as.factor(education)5         smokeintensity    I(smokeintensity^2)  </span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;             8.339e-01              1.130e-01             -2.240e-03  </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;              smokeyrs          I(smokeyrs^2)   as.factor(exercise)1  </span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;             1.034e-01             -1.473e-03              7.865e-01  </span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="co">#&gt;  as.factor(exercise)2     as.factor(active)1     as.factor(active)2  </span></span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a><span class="co">#&gt;             1.231e+00             -8.251e-01             -4.576e-01  </span></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a><span class="co">#&gt;                  wt71              I(wt71^2)  </span></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a><span class="co">#&gt;            -1.221e-01              8.616e-06  </span></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a><span class="co">#&gt; Degrees of Freedom: 1565 Total (i.e. Null);  1546 Residual</span></span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a><span class="co">#&gt; Null Deviance:       212700 </span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a><span class="co">#&gt; Residual Deviance: 175100    AIC: 11030</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>m2_dr<span class="sc">$</span>res<span class="sc">$</span>fit_exposure</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co">#&gt; Call:  fit_glm(formula = formula_exposure, family = family_exposure, </span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a><span class="co">#&gt;     data = data, response = &quot;exposure&quot;, weights = weights)</span></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a><span class="co">#&gt;           (Intercept)                   sex1                  race1  </span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="co">#&gt;            -2.2425191             -0.5274782             -0.8392636  </span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a><span class="co">#&gt;                   age               I(age^2)  as.factor(education)2  </span></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="co">#&gt;             0.1212052             -0.0008246             -0.0287755  </span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a><span class="co">#&gt; as.factor(education)3  as.factor(education)4  as.factor(education)5  </span></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co">#&gt;             0.0864318              0.0636010              0.4759606  </span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a><span class="co">#&gt;        smokeintensity    I(smokeintensity^2)               smokeyrs  </span></span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a><span class="co">#&gt;            -0.0772704              0.0010451             -0.0735966  </span></span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a><span class="co">#&gt;         I(smokeyrs^2)   as.factor(exercise)1   as.factor(exercise)2  </span></span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a><span class="co">#&gt;             0.0008441              0.3548405              0.3957040  </span></span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co">#&gt;    as.factor(active)1     as.factor(active)2                   wt71  </span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a><span class="co">#&gt;             0.0319445              0.1767840             -0.0152357  </span></span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co">#&gt;             I(wt71^2)  </span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a><span class="co">#&gt;             0.0001352  </span></span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a><span class="co">#&gt; Degrees of Freedom: 1565 Total (i.e. Null);  1547 Residual</span></span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a><span class="co">#&gt; Null Deviance:       1786 </span></span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a><span class="co">#&gt; Residual Deviance: 1677  AIC: 1715</span></span></code></pre></div>
<p>This is useful when we want to inspect the distribution of the
propensity scores by exposure status. This is an important thing to
check in practice, we are looking for any practical violations of the
positivity assumption.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">hist</span>(m2_dr<span class="sc">$</span>res<span class="sc">$</span>fit_exposure<span class="sc">$</span>fitted[nhefs_dat<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">0</span>], </span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;qsmk = 0&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;estimated propensity&quot;</span>)</span></code></pre></div>
<p><img
src="overview_files/figure-html/unnamed-chunk-9-1.png" /><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">hist</span>(m2_dr<span class="sc">$</span>res<span class="sc">$</span>fit_exposure<span class="sc">$</span>fitted[nhefs_dat<span class="sc">$</span>qsmk <span class="sc">==</span> <span class="dv">1</span>], </span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">main =</span> <span class="st">&quot;qsmk = 1&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;estimated propensity&quot;</span>)</span></code></pre></div>
<p><img
src="overview_files/figure-html/unnamed-chunk-9-2.png" /><!-- --></p>
<div id="other-outcome-types" class="section level2">
<h2>Other outcome types</h2>
<p>The function <code>standardize_glm</code> and its doubly-robust
counterpart <code>standardize_glm_dr</code> support any outcome variable
type the can be used with <code>glm</code>. This includes binary, count,
and more. Just like in <code>glm</code>, we specify the model we would
like to use for the outcome by specifying the <code>family</code>
argument of <code>standardize_glm</code> or the
<code>family_outcome</code> argument of <code>standardize_glm_dr</code>.
By default this is <code>"gaussian"</code> which corresponds to linear
regression. For a binary outcome we might like to use
<code>"binomial"</code> which corresponds to logistic regression. Let us
see how it works using the a binary outcome that we create by
dichotomizing the weight change at 0.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>nhefs_dat<span class="sc">$</span>gained_weight <span class="ot">&lt;-</span> <span class="fl">1.0</span> <span class="sc">*</span> (nhefs_dat<span class="sc">$</span>wt82_71 <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">standardize_glm</span>(gained_weight <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>            <span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">&quot;difference&quot;</span>, <span class="st">&quot;ratio&quot;</span>),</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>m3</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a><span class="co">#&gt; Outcome link function: logit </span></span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a><span class="co">#&gt; 1    0    0.639    0.0140      0.611      0.666</span></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a><span class="co">#&gt; 2    1    0.772    0.0195      0.733      0.810</span></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a><span class="co">#&gt; 1    0    0.000    0.0000     0.0000      0.000</span></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a><span class="co">#&gt; 2    1    0.133    0.0236     0.0866      0.179</span></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a><span class="co">#&gt; Contrast:  ratio </span></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="co">#&gt; 1    0     1.00    0.0000       1.00       1.00</span></span>
<span id="cb11-37"><a href="#cb11-37" tabindex="-1"></a><span class="co">#&gt; 2    1     1.21    0.0398       1.13       1.29</span></span></code></pre></div>
<p>Here we interpret the estimates in terms of probabilities, or the
risk of gaining weight over 11 years. In particular, smoking causes a
13% additive increase in the risk of gaining weight, or a 1.2 fold
multiplicative increase in the risk of gaining weight. With binary
outcomes, we can use transformations to get different contrasts, and
also to improve the performance of the ratio contrast. By using the log
transformation combined with the difference contrast, our estimates
become the log risk ratios. We can exponential them to get the risk
ratios, but often it is better to construct confidence intervals of
ratios on the log scale and back transform.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>m3_log <span class="ot">&lt;-</span> <span class="fu">standardize_glm</span>(gained_weight <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>            <span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">&quot;difference&quot;</span>),</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>            <span class="at">transforms =</span> <span class="fu">c</span>(<span class="st">&quot;log&quot;</span>),</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>m3_log</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a><span class="co">#&gt; Outcome link function: logit </span></span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a><span class="co">#&gt; 1    0   -0.448    0.0220     -0.492     -0.405</span></span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a><span class="co">#&gt; 2    1   -0.259    0.0253     -0.309     -0.210</span></span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a><span class="co">#&gt; 1    0    0.000    0.0000      0.000      0.000</span></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a><span class="co">#&gt; 2    1    0.189    0.0329      0.125      0.254</span></span></code></pre></div>
<p>The estimates reported in the table are log risk ratios, which we now
back transform by exponentiating and compare to the ratios estimated
previously.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>tm3_log <span class="ot">&lt;-</span> <span class="fu">tidy</span>(m3_log)</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>tm3_log<span class="sc">$</span>rr <span class="ot">&lt;-</span> <span class="fu">exp</span>(tm3_log<span class="sc">$</span>Estimate)</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>tm3_log<span class="sc">$</span>rr.lower <span class="ot">&lt;-</span> <span class="fu">exp</span>(tm3_log<span class="sc">$</span>lower.<span class="fl">0.95</span>)</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>tm3_log<span class="sc">$</span>rr.upper <span class="ot">&lt;-</span> <span class="fu">exp</span>(tm3_log<span class="sc">$</span>upper.<span class="fl">0.95</span>)</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">subset</span>(tm3_log, contrast <span class="sc">==</span> <span class="st">&quot;difference&quot;</span> <span class="sc">&amp;</span> qsmk <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt;   qsmk  Estimate  Std.Error lower.0.95 upper.0.95   contrast transform       rr</span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt; 4    1 0.1890909 0.03292713  0.1245549  0.2536269 difference       log 1.208151</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a><span class="co">#&gt;   rr.lower rr.upper</span></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="co">#&gt; 4 1.132644 1.288691</span></span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>m3</span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="co">#&gt; Outcome link function: logit </span></span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a><span class="co">#&gt; 1    0    0.639    0.0140      0.611      0.666</span></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a><span class="co">#&gt; 2    1    0.772    0.0195      0.733      0.810</span></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a><span class="co">#&gt; 1    0    0.000    0.0000     0.0000      0.000</span></span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="co">#&gt; 2    1    0.133    0.0236     0.0866      0.179</span></span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a><span class="co">#&gt; Contrast:  ratio </span></span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a><span class="co">#&gt; 1    0     1.00    0.0000       1.00       1.00</span></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a><span class="co">#&gt; 2    1     1.21    0.0398       1.13       1.29</span></span></code></pre></div>
<p>In this case, the estimates and inference using transformation are
nearly identical to those without transformation.</p>
<p>Other available transformations include the odds, and logit (log
odds). These can be used to estimate causal odds ratios, untransformed
and transformed, respectively.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>m3_odds <span class="ot">&lt;-</span> <span class="fu">standardize_glm</span>(gained_weight <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>            <span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">&quot;ratio&quot;</span>),</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>            <span class="at">transforms =</span> <span class="fu">c</span>(<span class="st">&quot;odds&quot;</span>),</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>m3_odds</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="co">#&gt; Outcome link function: logit </span></span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a><span class="co">#&gt; 1    0     1.77     0.108       1.56       1.98</span></span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a><span class="co">#&gt; 2    1     3.38     0.374       2.64       4.11</span></span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a><span class="co">#&gt; Contrast:  ratio </span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a><span class="co">#&gt; 1    0     1.00     0.000       1.00       1.00</span></span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a><span class="co">#&gt; 2    1     1.91     0.238       1.44       2.38</span></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>m3_logit <span class="ot">&lt;-</span> <span class="fu">standardize_glm</span>(gained_weight <span class="sc">~</span> qsmk <span class="sc">+</span> sex <span class="sc">+</span> race <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a>               <span class="fu">as.factor</span>(education) <span class="sc">+</span> smokeintensity <span class="sc">+</span> <span class="fu">I</span>(smokeintensity<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a>               smokeyrs <span class="sc">+</span> <span class="fu">I</span>(smokeyrs<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">as.factor</span>(exercise) <span class="sc">+</span> <span class="fu">as.factor</span>(active) <span class="sc">+</span></span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>               wt71 <span class="sc">+</span> <span class="fu">I</span>(wt71<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>            <span class="at">data =</span> nhefs_dat, </span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>            <span class="at">family =</span> <span class="st">&quot;binomial&quot;</span>,</span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>            <span class="at">values =</span> <span class="fu">list</span>(<span class="at">qsmk =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)),</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>            <span class="at">contrasts =</span> <span class="fu">c</span>(<span class="st">&quot;difference&quot;</span>),</span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>            <span class="at">transforms =</span> <span class="fu">c</span>(<span class="st">&quot;logit&quot;</span>),</span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>            <span class="at">reference =</span> <span class="dv">0</span>)</span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a><span class="co">#&gt; Warning in model.matrix.default(mt, mf, contrasts): non-list contrasts argument</span></span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a><span class="co">#&gt; ignored</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>m3_logit</span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a><span class="co">#&gt; Outcome formula: gained_weight ~ qsmk + sex + race + age + I(age^2) + as.factor(education) + </span></span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a><span class="co">#&gt;     smokeintensity + I(smokeintensity^2) + smokeyrs + I(smokeyrs^2) + </span></span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a><span class="co">#&gt;     as.factor(exercise) + as.factor(active) + wt71 + I(wt71^2)</span></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a><span class="co">#&gt; Outcome family: quasibinomial </span></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a><span class="co">#&gt; Outcome link function: logit </span></span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a><span class="co">#&gt; Exposure:  qsmk </span></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a><span class="co">#&gt; Tables: </span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a><span class="co">#&gt; 1    0    0.569    0.0609       0.45      0.689</span></span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a><span class="co">#&gt; 2    1    1.217    0.1108       1.00      1.434</span></span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a><span class="co">#&gt; Transform:  </span></span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a><span class="co">#&gt; Reference level:  qsmk = 0 </span></span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a><span class="co">#&gt; Contrast:  difference </span></span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a><span class="co">#&gt;   qsmk Estimate Std.Error lower.0.95 upper.0.95</span></span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a><span class="co">#&gt; 1    0    0.000     0.000      0.000      0.000</span></span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a><span class="co">#&gt; 2    1    0.648     0.124      0.404      0.892</span></span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a></span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a>m3_logOR <span class="ot">&lt;-</span> <span class="fu">tidy</span>(m3_logit) <span class="sc">|&gt;</span> </span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a>  <span class="fu">subset</span>(contrast <span class="sc">==</span> <span class="st">&quot;difference&quot;</span> <span class="sc">&amp;</span> qsmk <span class="sc">==</span> <span class="dv">1</span>) </span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a>  </span>
<span id="cb14-70"><a href="#cb14-70" tabindex="-1"></a><span class="fu">sprintf</span>(<span class="st">&quot;%.2f (%.2f to %.2f)&quot;</span>, <span class="fu">exp</span>(m3_logOR<span class="sc">$</span>Estimate), </span>
<span id="cb14-71"><a href="#cb14-71" tabindex="-1"></a>        <span class="fu">exp</span>(m3_logOR<span class="sc">$</span>lower.<span class="fl">0.95</span>), <span class="fu">exp</span>(m3_logOR<span class="sc">$</span>upper.<span class="fl">0.95</span>))</span>
<span id="cb14-72"><a href="#cb14-72" tabindex="-1"></a><span class="co">#&gt; [1] &quot;1.91 (1.50 to 2.44)&quot;</span></span></code></pre></div>
<p>In this case the estimate is identical, but the confidence interval
is slightly different because it is symmetric on the odds ratio scale in
the first case, and symmetric on the log odds ratio scale in the
transformed case.</p>
<div id="refs" class="references csl-bib-body hanging-indent"
entry-spacing="0">
<div id="ref-gabriel2023inverse" class="csl-entry">
Gabriel, Erin E, Michael C Sachs, Torben Martinussen, Ingeborg
Waernbaum, Els Goetghebeur, Stijn Vansteelandt, and Arvid Sjölander.
2024. <span>“Inverse Probability of Treatment Weighting with Generalized
Linear Outcome Models for Doubly Robust Estimation.”</span>
<em>Statistics in Medicine</em> 43 (3): 534–47.
</div>
<div id="ref-sjolander2016regression" class="csl-entry">
Sjölander, Arvid. 2016. <span>“Regression Standardization with the r
Package stdReg.”</span> <em>European Journal of Epidemiology</em> 31:
563–74.
</div>
<div id="ref-sjolander2018estimation" class="csl-entry">
———. 2018. <span>“Estimation of Causal Effect Measures with the
r-Package stdReg.”</span> <em>European Journal of Epidemiology</em> 33:
847–58.
</div>
<div id="ref-witte2019covariate" class="csl-entry">
Witte, Janine, and Vanessa Didelez. 2019. <span>“Covariate Selection
Strategies for Causal Inference: Classification and Comparison.”</span>
<em>Biometrical Journal</em> 61 (5): 1270–89.
</div>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
